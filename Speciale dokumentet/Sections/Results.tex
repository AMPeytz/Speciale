\ifdefined\COMPILINGMAIN
% Main file is compiling this section, skip the preamble
\else
% Individual file compilation
\documentclass[11pt]{article}
\input{../Preamble.tex}  % Include the main preamble
\begin{document}
\fi

\section{Results} \label{Section: Results}
For the following results we consider 3 types of parameterizations for the portfolio problem.
The first is a simple case where the assets are identically distributed as seen in \autocite{CaiJuddXu2013},
the second is a case where the parameters are chosen to match the parameters in \autocite{Schober2022} also seen in \autocite{Scheidegger2023}.
This is in order to be able to draw correct comparisons between the results. Furthermore this case,
displays assets with slight variation in the mean and a small correlation between the assets, and no asset is dominating the others.
The last parameterization is a modification of the first case where the correlation between the assets is large (correlation coefficient of $0.75$), but no perfect correlation. 
\begin{table}[!ht]
    \label{table: Parameters_Base_Models}
    \centering
    \caption{Parameters for Examples of Portfolio Problems}
    \begin{tabular}{lccc}
    \toprule
    & \textbf{i.i.d Assets} & \textbf{Schober Parameters} & \textbf{High Correlation} \\
    \midrule
    $T$        & 6                & 6                & 6                \\
    $k$        & 3                & 5                & 3                \\
    $\gamma$   & 3.0              & 3.5              & 3.0              \\
    $\tau$     & 0.5\%            & 0.5\%            & 0.5\%            \\
    $\beta$    & 0.97             & 0.97             & 0.97             \\
    $r$        & $3$\% & $4$\%    &  $3$\% \\
    $\mu^\top$ & (0.07, 0.07) & $\mu_{\text{Shober}}$ & (0.07, 0.07) \\
    $\Sigma$   & 
    $\begin{bmatrix}
    0.04 & 0.00 \\
    0.00 & 0.04
    \end{bmatrix}$
    & $\Sigma_{\text{Schober}}$ 
    & 
    $\begin{bmatrix}
    0.04 & 0.03\\
    0.03 & 0.04
    \end{bmatrix}$ \\
    \bottomrule
    \end{tabular}
\end{table}
\[
\mu_{\text{Schober}}^\top = 
\begin{bmatrix}
0.0572 & 0.0638 & 0.07 & 0.0764 & 0.0828
\end{bmatrix}
\]
% Define the Schober covariance matrix
\[
\Sigma_{\text{Schober}} = 
\begin{bmatrix}
0.0256 & 0.00576 & 0.00288 & 0.00176 & 0.00096 \\
0.00576 & 0.0324 & 0.0090432 & 0.010692 & 0.01296 \\
0.00288 & 0.0090432 & 0.04 & 0.0132 & 0.0168 \\
0.00176 & 0.010692 & 0.0132 & 0.0484 & 0.02112 \\
0.00096 & 0.01296 & 0.0168 & 0.02112 & 0.0576 \\
\end{bmatrix}
\]
\subsection{Dynamic Portfolio Choice without consumption} \label{Subsection: Results_NoConsumption}
I first consider the base model with proportional transaction costs
and no consumption. In the absence of consumption, the optimal portfolio is the merton point, which we plot in every figure.
I plot the No-trade region at time point 0 (initial time point) for each of the parameterizations in figure \ref{fig:comparison_NTR}.
When using the Schober parameters we select the $d$ first elements of the mean vector, and truncate the covariance matrix to a $d \times d$ matrix,
depending on the number of assets $d$ in the model.
\begin{figure}[!ht]
    \centering
    % Top figure
    \begin{subfigure}[t]{\textwidth}
        \centering
        \includegraphics[scale=0.45]{NTR_Cai_Identical_d2_tau_0.005__no_consumption_t_0.png}
        \caption{No Trade Region for Independent Identically Distributed Assets.}
        \label{fig:NTR_2d_iid}
    \end{subfigure}

    % Space between the top and the bottom row
    \vspace{1em}

    % Bottom figures side by side
    \begin{subfigure}[t]{0.48\textwidth}
        \centering
        \includegraphics[scale=0.45]{NTR_Schober_Parameters_d2_tau_0.005__no_consumption_t_0.png}
        \caption{No Trade Region for Schober Parameters.}
        \label{fig:NTR_2d_Schober}
    \end{subfigure}%
    \hfill
    \begin{subfigure}[t]{0.48\textwidth}
        \centering
        \includegraphics[scale=0.45]{NTR_Cai_High_Correlation_d2_tau_0.005__no_consumption_t_0.png}
        \caption{No Trade Region for High Correlation.}
        \label{fig:NTR_2d_High_Correlation}
    \end{subfigure}

    % Overall caption
    \caption{Comparison of No Trade Regions.}
    \label{fig:comparison_NTR}
\end{figure}
I note that for each of the parameterizations the No-Trade region is a rectangle or parallelogram.
For the case of identical and independent assets, the No-Trade region is a perfect square, whereas for the Schober parameters and the high correlation case,
the No-Trade region is a parallelogram. This is due to the correlation between the assets. When some correlation is present, the No-Trade region is skewed,
since some allocations which would be optimal in the absence of correlation are no longer optimal.

\subsubsection{Verifying the geometric shape of the No-trade Region}\label{Subsubsection: ConfirmShape}
Since much of the procedure for solving this problem, and approximating the NTR, leverages
the a-priori assumptions regarding the geometric shape of the NTR, i first want to verify that the
NTR indeed has $4$ vertices for the 2d case and is a convex hull.\\
In order to do this, i do a small modification to the solution algorithm proposed earlier.
Instead of computing vertices using $2^{d}$ predetermined points, i will instead
sample a larger set of points, ($2^7 = 128$) covering the boundaries of the feasible state space.
For each of these points i then solve the optimization problem,
and plot the solution, from allocations $\mathbf{x}_{t}$ and their solutions to the problem $\hat{\boldsymbol{\omega}}_{t}$.
I do this by using my original sample scheme, and adding mid-points between points,
which either sum to $1.0$ or have $0.0$ as allocation for one of the assets.
I consider the i.i.d case and the high correlation case, with $tau = 1\%$. I have increased the costs slightly in order to increase the
size of the NTR. This is to ensure that points also converge towards the faces and not only the verticies.
This is akin the the green regions in figure \ref{fig:no_trade_region_schematic}.
Otherwise i would need more points. I plot the solutions for next to last period with investment decisions $T-2$.
The solutions are plotted below.

\begin{figure}[!ht]
    \centering
    \begin{subfigure}[t]{0.48\textwidth}
        \centering
        \includegraphics[scale = 0.36]{Verify_NTRCai_Identical_t_4.png}
        \caption{Solutions to the i.i.d case with 2 assets in period $T-2$.}
        \label{fig:NTR_verify_iid}
    \end{subfigure}%
    \hfill
    \begin{subfigure}[t]{0.48\textwidth}
        \centering
        \includegraphics[scale = 0.36]{Verify_NTRCai_High_Correlation_t_4.png}
        \caption{Solutions to the high correlation case with 2 assets in period $T-2$.}
        \label{fig:NTR_verify_Correlation}
    \end{subfigure}

    % Overall caption
    \caption{Verifying the assumptions of the NTR iin $2$ dimensions.}
    \label{fig:NTR_Verify}
\end{figure}
I find that the assumptions regarding the \ac{NTR} are indeed correct in the two dimensional examples i have constructed.
Furthermore this verifies that the assumptions also hold for correlated asset, which was only postulated by \autocite{liu2002}.
Furthermore these plots also nicely confirm that the optimization process as a whole works as intended.
Further verification in higher dimensions are not considered. First of all \autocite{liu2002} confirms this formally in larger dimensions,
for the case of uncorrelated assets, and the intuition regarding the \ac{NTR} does not change when dimensionality is increased.

\subsubsection{Investigating the No-Trade Region} \label{Subsubsection: InvestigatingNTR}
We now look at the No-Trade region for the base model with proportional transaction costs and no consumption in more detail.
Specifically we look at how the region behaves over the entire investment horizon $[0, T]$, and how the region changes with different transaction cost levels.
We choose to look at the model with the Schober parameters, as this is a mixture of the other two parameterizations.

\begin{figure}[!ht]
    \centering
    \includegraphics[scale = 0.45]{NTR_Schober_Parameters_d2_tau_0.005__no_consumption_Over_Time_t_5.png}
    \caption{No Trade Region for Schober Parameters over Time.}
    \label{fig:NTR_2d_iid_standalone}
    \floatfoot{The No-Trade region is plotted for the Schober parameters over the entire investment horizon $[0, T-1]$
    For time points $t\in [0,T-2]$ the \ac{NTR}s overlap.}
\end{figure}

I note that at the last time point $t = T-1$ the \ac{NTR} moves away from the merton point towards the origin, and the Merton point is is
now the upper right corner of the \ac{NTR}. For all other time periods the \ac{NTR} is the same, and the Merton point is in the center.
This is consistent with behaviour found by \autocite{CaiJuddXu2013}, and might suggest that we only require solutions of two periods, $T-1$ and $T-2$ in order to
effectively cover the \ac{NTR} for all periods.

\begin{figure}[!ht]
    \centering
    \includegraphics[scale = 0.45]{NTR_Cai_IdenticalDifferent_Tau_t_3.png}
    \caption{No Trade Region for the iid Parameters with different values of $\tau$.}
    \label{fig:NTR_2d_iid_tau_analysis}
\end{figure}
I now investigate how the No-Trade region changes with different transaction cost levels.
I do this for the i.i.d. parameters, and plot the \ac{NTR} for different values of $\tau$ in \autoref{fig:NTR_2d_iid_tau_analysis}.
When the transaction costs are increased, the \ac{NTR} increases aswell and vice-versa. 
I note that for low enough transaction costs, the \ac{NTR} shrinks towards the Merton point.
However when transaction costs are low enough, the Merton point is not in the excact center, which might signify that at low enough values, some numerical instabilities from the
minimizer, and function approximation using \ac{GPR} might be present.

\subsubsection{Increasing the dimensionality of the model} \label{Subsubsection: IncreasingDimensionality}
We now increase the dimensionality of the model to $d = 3$ and look at the No-Trade region for the Schober parameters and for the i.i.d parameters.

\begin{figure}[!ht]
    \centering
    \begin{subfigure}[t]{0.48\textwidth}
        \centering
        \includegraphics[scale = 0.45]{NTR_Schober_Parameters_d3_tau_0.005__no_consumption_t_0.png}
        \caption{No Trade Region for Schober Parameters in 3 dimensions.}
        \label{fig:NTR_3d_Schober}
    \end{subfigure}%
    \hfill
    \begin{subfigure}[t]{0.48\textwidth}
        \centering
        \includegraphics[scale = 0.45]{NTR_Cai_Identical_d3_tau_0.005__no_consumption_t_3.png}
        \caption{No Trade Region for i.i.d. Parameters in 3 dimensions}
        \label{fig:NTR_3d_iid_Correlation}
    \end{subfigure}

    % Overall caption
    \caption{Comparison of No Trade Regions.}
    \label{fig:comparison_NTR_3d}
\end{figure}
Note that the i.i.d NTR looks like a skewed cube, whereas this was a perfect square in the 2 dimensional case.
Looking that the points forming the convex hull that is the NTR, it is clear that the NTR is restricted by the no-borrowing constraint,
since one of the border points, which would otherwise form the perfect cube, would outside the feasible space if this was possible, and is then projected into the feasible space. 
Hence when the risky returns outweigh the risk-free return,
to such a degree that the merton point moves towards the boundary of the feasible space, cube like shapes are no longer possible.
In the $2$ dimension case, this is akin to the \ac{NTR} being close to the budget line, and the \ac{NTR} would then form a triangle.

This is clear when compared to the Schober parameters, where the merton point is in the center of the NTR, and the NTR is a skewed cube.
The merton point in this case suggest lower portfolio allocations to the risky assets, and hence the NTR is not restricted by the no-trading and no-borrowing constraints.

Furthermore the \ac{NTR} behaves similar to the $2$d case, and is only considerably different in period $T-1$,
compared to periods $T-2$, $T-3$ and so forth.

\subsubsection{Increasing the dimensionality of the model further} \label{Subsubsection: IncreasingDimensionalityFurther}
I now look at increasing the dimensionality of the model even further.
This moves the solutions of the model to higher dimensional spaces, which have well defined mathematical properties, however,
graphic illustration will be moved to $3$ dimensions, as the model is not easily visualized in higher dimensions.
I solve the model with the Schober parameters for $d = 5$ assets. This increases the complexity of the model, and the \ac{NTR} is now a hyper-cube,
however solutions remain feasible, despite the algorithm running on a laptop computer.
For the $d = 5$ case, the merton point is $(0.1531, 0.0682, 0.0983, 0.1132, 0.1242)$ which suggest a total risky investment portfolio of $55.7\%$ of wealth.
I use $60\cdot D = 300$ generated points and their respective solutions to train the \ac{GP} in each iteration.
Approximating the \ac{NTR} alone, now takes considerably longer, and larger dimensions $D>5$ are therefore not in the scope of this paper, as the computational power required
is too large for me to handle.
However, solutions to the $5$ risky asset porfolio, on a personal laptop, remains a computational feat, as previous studies \autocites{CaiJuddXu2013}{Schober2022} relied on super computers to solve the model.
\autocite{Scheidegger2023} makes no mention of the computational setup, and a direct comparison to the results is therefore dissapointingly not possible, 
to the most similar setup in the literature.
\subsection{Dynamic Portfolio Choice with consumption} \label{Subsection: Results_WithConsumption}
I now consider the base model with proportional transaction costs which now includes consumption of a non-durable good.
This adds an extra decision variable which needs to be solved for, and consumption now adds immediate utility to the investor, in each period.
\begin{figure}[!ht]
    \centering
    \begin{subfigure}[t]{0.48\textwidth}
        \centering
        \includegraphics[scale = 0.45]{NTR_Cai_Identical_d2_tau_0.005__with_consumption_Over_Time_t_5.png}
        \caption{No Trade Region for i.i.d parameters over time with consumption.}
        \label{fig:NTR_2d_iid_with_consumption_over_time}
    \end{subfigure}%
    \hfill
    \begin{subfigure}[t]{0.48\textwidth}
        \centering
        \includegraphics[scale = 0.45]{NTR_Cai_High_Correlation_d2_tau_0.005__with_consumption_Over_Time_t_5.png}
        \caption{No Trade Region for high correlation parameters over time with consumption.}
        \label{fig:NTR_2d_high_correlation_with_consumption_over_time}
    \end{subfigure}
    % Overall caption
    \caption{Comparison of No Trade Regions over time with consumption.}
    \floatfoot{The No-Trade regions are plotted over the entire investment horizon $[0, T-1]$.}
\end{figure}

Note that when consumption is included, the \ac{NTR} no longer encapulates the Merton point at any time point.
Furthermore the \ac{NTR} now moves over time, towards the origin, as opposed to the case without consumption,
where the \ac{NTR} was static for all time points except the next to last period (last period with trading decisions).
Hence, the \ac{NTR} is now no longer sufficiently described by solutions to $T-1$ and $T-2$ as the optimal consumption decision,
changes over time, moving the NTR towards the origin, as $t \rightarrow 0$. 
This behaviour is consistent in higher dimensions, and is consistent with results found by \autocite{Scheidegger2023}.
Below are plots of the NTR for two different parametizations of the model, with $3$ assets, at a singular time point.
\begin{figure}[!ht]
    \centering
    \begin{subfigure}[t]{0.48\textwidth}
        \centering
        \includegraphics[scale = 0.45]{NTR_Cai_Identical_d3_tau_0.005__with_consumption_t_2.png}
        \caption{No Trade Region for i.i.d parameters with consumption in 3d.}
        % \label{fig:NTR_2d_iid_with_consumption_over_time}
    \end{subfigure}%
    \hfill
    \begin{subfigure}[t]{0.48\textwidth}
        \centering
        \includegraphics[scale = 0.45]{NTR_Schober_Parameters_d3_tau_0.005__with_consumption_t_2.png}
        \caption{No Trade Region for Schober parameters with consumption in 3d.}
        % \label{fig:NTR_2d_high_correlation_with_consumption_over_time}
    \end{subfigure}
    % Overall caption
    \caption{No trade regions with consumption in multiple dimensions, singular time period.}
    \floatfoot{The No-Trade regions are plotted at time $t=2$.}
\end{figure}
And i can, similar to the $2$d case, plot the \ac{NTR} over the entire investment horizon, as seen in figure \ref{fig: NTR_3d_iid_with_consumption_over_time}.
\begin{figure}[!ht]
    \centering
    \includegraphics[scale = 0.38]{NTR_Cai_Identical_d3_tau_0.005__with_consumption_Over_Time_t_5.png}
    \caption{NTR for $3$ assets with i.i.d parameters over time with consumption.}
    \label{fig: NTR_3d_iid_with_consumption_over_time}
\end{figure}
Once again, i note that the NTR moves towards the Merton point as $t \rightarrow T$, but never encapulates the Merton Point. 


\subsection{Dynamic Portfolio Choice with fixed costs} \label{Subsection: Results_FixedCosts_No_Correlation}
I now consider the base model with fixed transaction costs, and no consumption.
From \autocite{Dybvig2020} i know that the \ac{NTR} is no longer rectangular when we only consider fixed costs, but instead circular with the merton point in the middle when there is no consumption in the model.
This poses a problem for my current sampling scheme, which leverages my predetermined knowledge of the geometric shape of the \ac{NTR}.
As i noted in Section \ref{Subsection: Approximating_NTR}, in order to effectively sample points for the \ac{NTR} approximation, given the framework for the proportional cost case,
 i now need to sample points, such that when they hit the \ac{NTR} these points are evenly distributed on the sphere, in order to approximate the \ac{NTR} correctly.\\
However this is still not sufficient as the fixed costs pose further problems for the solution algorithm. In order to see this a little intuition is needed.

Transaction costs no longer scale in the fixed case, but are treated as a \textit{sunk cost}, the moment the decision to trade is made. Hence if trading is optimal, the investor will trade to the optimal point,
and if trading is sub-optimal then no trading will occur. The problem is therefore first of all a trading decision problem, and if trading is optimal, then the investor will trade to the merton point when no consumption is present, as this is the optimal point.

This is in stark contrast to the proportional case, where the trading trajectory from outside the \ac{NTR} was to the border of the \ac{NTR}, and the \ac{NTR} approximation could be done by sampling points on the border of the feasible space.

Now, any point sampled outside the \ac{NTR} trades to the merton point, and i need to construct a new strategy, 
in order to efficiently construct the \ac{NTR}, as no new information is
gained by sampling multiple points outside the \ac{NTR}.

Furthermore, the transaction cost function is now an indicator function, depending on a threshhold, i.e $\sum^{k}_{i=1} \delta^{+}_{i,t} + \delta^{-}_{i,t}  > 0$.
This is non-differentiable at the kink, $\sum^{k}_{i=1} \delta^{+}_{i,t} + \delta^{-}_{i,t} =0$ 
which is a critical point (the trading decision boundary), which i have to deal with, in order to solve the optimization problem.

I therefore split the optimization process into two parts. I evaluate the objective function (value function), \textit{conditional} on no trading ($\boldsymbol{\delta}_{t} = \mathbf{0}$), and \textit{conditional} on trading ($\boldsymbol{\delta}_{t} \neq \mathbf{0}$).
Since there is no consumption decision the no-trading decision is trivial, whereas i still optimize the trading decision in the trading problem, in order to maximize expected utility. 
By splitting the optimization process, i can avoid the the non-differentiable edge case, and the derivative with regard to fixed costs is trivial for the optimizer.
I then evaluate the value function for the no-trading decision, and the trading decision, and choose the decision which maximizes the value function.

I now consider the base model with fixed transaction costs, and no consumption. I use the simple i.i.d parameterization, with $2$ assets and solve the optimization problem for the next to last period $T-1$,
over an evenly spaced grid of points. I do this in order to verify that the solution algorithm works as intended, and that the \ac{NTR} is circular as expected, conflicting with my prior assumptions for the proportional case.

I set the fixed costs to $0.005\%$ of the investors total wealth, at any time point, and solve at a very fine grid of points, in order to approximate the \ac{NTR} correctly.
I find that the \ac{NTR} is circular as expected, and the solution algorithm works as intended. I therefore proceed with generating a strategy for dealing with fixed costs, which can leverage my new found knowledge of the \ac{NTR}.
\begin{figure}[!ht]
    \centering
    \includegraphics[scale = 0.38]{Verify_NTR_FixedCai_Identical_t_5.png}
    \caption{Solution to the i.i.d case with fixed costs, 2 assets in period $T-1$.}
    \label{fig:NTR_verify_fixed_no_correlation}
    \floatfoot{The optimization scheme ran with $5044$ evenly spaced grid points. The points are plotted in the feasible space, and the \ac{NTR} is the convex hull of these points.}
\end{figure}

\subsubsection{Constructing a new sampling scheme for the fixed cost NTR} \label{Subsubsection: SampleFixed}
Noting that for each point outside the NTR, the investor will trade to the same optimal point, since the cost of trading is a \textit{sunk cost},
i can select a single starting point, at the origin for example, and solve for the optimal trading decision.
If the optimal decision is to trade, then i immediatly know the center of the \ac{NTR}, and now only need the radius to construct the \ac{NTR}.
This holds for any dimensionsionality of the model, as any circle/sphere/hypersphere can be defined by the center point and the radius.

I find the radius, by slowly moving towards one of the boundary starting points, from the center of the NTR, solving the optimization problem for each point,
and noting when trading occurs (return to the center). By using a bisection method\footnote{Which is simple to implement since we only consider allocations along the straight line from some angle, outwards from the center of the NTR},
i find the border of the \ac{NTR} with a tolerance of $50^{-7}$,
which is a tolerance of $0.00005\%$ of the total wealth of the investor. I solve for multiple directions from the center, and choose the largest radius. This is because the circle might be truncated along the borders of the feasible space,
if the NTR is close to either of the axis or the budget constraint (no borrowing/shorting).
Furthermore, by selecting directions in evenly spaced angles around the center, i ensure that one of the directions of trading, must hit the border, as along as the \ac{NTR} does not cover the entire feasible space.
For the latter case, the algorithm would never find a center point initially, and the solution is trivial any how.

This optimization process can be seen in figure \ref{fig:NTR_verify_fixed_no_correlation}. I start from a blue point and rebalance to the Merton point.
Following this, i move along a straight line outwards, and solve. If no trading occurs the point is red, and is in the \ac{NTR}. 
This is repeated for each trading direction. The figure below displays this specific part of the algorithm:
\begin{figure}[!ht]
    \centering
    \includegraphics[scale = 0.38]{Circular_NTR_Approximation_Algorithm.png}
    \caption{2-Dimensional approximation algorithm for the fixed cost NTR with no correlation.}
    \label{fig:FixedCost_NTR_Approximation}
    % \floatfoot{}
\end{figure}


I also need to consider the sampling strategy for my \ac{GPR}-related training points. As i mentioned previously, i need to sample three types of points.
Points within the \ac{NTR}, points outside the \ac{NTR}, and points near the border border the \ac{NTR}. The last points was previously kink points,
when the NTR had followed assumptions \ref{assumption: NTR-convex} and \ref{assumption: NTR-vertices}, however for the circular case there are no kinks.
The previous sampling strategy is easily applicable to the circlur case, however for the border points, i change the strategy slightly.
I sample evenly spaced points (defined by their relative angle to the center point) on the border of the approximated \ac{NTR}, and add a slight pertubation to ensure these are outside the NTR.
This effectively covers the entire circle, and i can now leverage a low amount of training points for the GPR, as for the proportional cost case.
\begin{figure}[!ht]
    \centering
    \includegraphics[scale = 0.38]{Fixed_Costs_sampling_strategy.png}
    \caption{2-Dimensional sampling strategy for the fixed cost NTR, with no consumption or correlation.}
    \label{fig:Sample_Strategy_Fixed}
    \floatfoot{this sample strategy uses the same number of points as the schematic for the proportional cost sampling strategy}
\end{figure}
The fixed costs problem can likewise be solved in higher dimensions, however since this poses no changes to the proposed solution methods,
i do not consider this further, and continue to the correlated case.
I solve the problem with the i.i.d parameters and a fixed cost of $0.075\%$ of the investors total wealth at any time point. I consider an investment horizon of $T = 5$.
\begin{figure}[!ht]
    \centering
    \begin{subfigure}[t]{0.48\textwidth}
        \centering
        \includegraphics[scale = 0.38]{Fixed_Cost_NTR_Over_Time_Fixed_Cai_Identical_2d_fc_0.00075_t_4.png}
        \caption{NTR at each time step for i.i.d parameters, with $2$ risky assets, fixed costs and no consumption.}
        \label{fig:Fixed_NTR_2d_iid_over_time}
        \floatfoot{Sample points for the GPR used 140 points. Fixed costs at $0.075\%$ of total wealth.}
    
    \end{subfigure}%
    \hfill
    \begin{subfigure}[t]{0.48\textwidth}
        \centering
        \includegraphics[scale = 0.38]{Fixed_Cost_NTR_Cai_Identical_d3_fc_0.0005__no_consumption_t_5.png}
        \caption{NTR at time step $T-1$ for i.i.d parameters, with $3$ risky assets, fixed costs and no consumption.}
        \label{fig:NTR_3d_iid_T-1}
        \floatfoot{Sample points for the GPR used 210 points. Fixed costs at $0.075\%$ of total wealth.}    
    \end{subfigure}
    % Overall caption
    \caption{No trade regions with i.i.d assets.}
\end{figure}
For the $2$D plot i note that the NTR displays slight jitter, shrinking slightly over time. This is due to slight numerical instability over time. As function approximators
are used iteratively to approximate the value function, the approximation error is compounded over time.
I Note that the NTR at the terminal decision period $T-1$ is slightly larger than for other periods.
At time step $T-1$ the radius is $0.16$ whereas for time step $T-5$ ($0$) the radius is $0.11$.
Hence when fixed costs are considered only two periods need to be solved for, in order to approximate the NTR over the entire investment horizon.
Any more solutions will only add to the approximation error, and the NTR will not change significantly.
I note for the $3$D case that the NTR is now a sphere, which is to be expected, as the NTR has extended to higher dimensions before, keepings its original shape.
In order to approximate the higher order \ac{NTR}s, i use a similar fitting scheme as in figure \ref{fig:FixedCost_NTR_Approximation}.
This is displayed in figure \ref{fig: Sphere_Fitting_Appendix} located in appendix \ref{section: Fitting_Ellipse_Appendix}.

\subsection{Dynamic Portfolio Choice with fixed costs and correlation}
I now solve the model for correlared assets, that is, i solve for the Schober parametization and for the high correlation parameterization.
I set the fixed costs to $0.005\%$ of the investors total wealth at any time point, and consider an investment horizon of $T = 5$.
For the proportional cost case, when assets where correlated, the square was shifted into a parallelogram shape, and i expect the same to happen for the fixed cost case,
shifting the circle into an ellipse. I first solve the $2$D case for the high correlation case, as this parameterization 
should have the most pronounced effect on the geometric shape of the \ac{NTR}. Furthermore i want to verify that the \ac{NTR} solution,
once again, is defined by two distinct regions, one for $t = T-1$ and one for $t < T-1$, as noted in figure \ref{fig:Fixed_NTR_2d_iid_over_time}.
I first verify the shape of the NTR for the high correlation case, by solving over a fine grid as previously mentioned.

\begin{figure}[!ht]
    \centering
    \includegraphics[scale = 0.38]{Verify_NTR_FixedCai_High_Correlation_t_5.png}
    \caption{Solution to the high correlation case with fixed costs and 2 assets in period $T-1$.}
    \label{fig:NTR_Verify_High_Correlation}
    \floatfoot{The optimization scheme ran with $5253$ evenly spaced grid points. The points are plotted in the feasible space, and the \ac{NTR} is the convex hull of these points. Fixed costs at $0.0005$.}
\end{figure}

I note from figure \ref{fig:NTR_Verify_High_Correlation} that the NTR is now an ellipse, as expected.
This new shape is due to the correlation between the assets, and the NTR is now skewed, as the correlation between the assets is not $0$.
I then need to reformulate the solution algorithm for this case, as the NTR is no longer circular, and the solution algorithm for the fixed costs case is no longer applicable,
since an ellipse is not defined by a center point and a radius. I need to reformulate the solution algorithm, in order to approximate the NTR correctly.\\
An ellipse in $2$ dimensions is defined by its \textit{foci}. For any point on the ellipse, the sum of the distances to the foci is constant.
The ellipse has a major diameter (major axis), and a minor diameter (minor axis), respectively the longest and shortest distance between two points on the ellipse
\autocite{Ivanov2020Ellipse}. Given a center point and enough points on the border of the ellipse (which may be noisy)
i can approximate the ellipse by a least squares algorithm \autocite{gander1994least}. This requires enough points in order to solve the the problem sufficiently,
for $2$ dimensions the minimum required points is $5$ points with no three points collinear. For higher dimensions the required points are $d(d+3)/2$ points,
however otherwise the same procedure can be applied \autocite{bertoni2010multi}.

I modify the solution algorithm in the following manner.
I solve the optimization problem for a single point outside the NTR, and find the optimal trading decision towards the center\footnote{I do this for a few points in order to ensure that the point is outside the unknown NTR. However, a singular point is all that is needed. For example full investment into one of the risky assets, will most likely fall outside the NTR.}.
I then sample $d(d+3)/2+2^{d}+d+1$ points, on the borders of the NTR. The $2^{d}$ points are the border points used for the square \ac{NTR} sampling scheme.
I then add $d(d+3)/2+d+1$ random points, which are still on the border of the feasible space, by drawing random points on the border\footnote{I constrain these points so they are sufficiently distanced from my previously sampled points. This ensures that the resulting directions from the center are unique, and border points are not identical.}.
This should leave me with enough points to approximate the ellipse, which are not collinear.
I then proceed with the bisection algorithm as previously mentioned, until i for each outwards direction from the center, find the border point of the \ac{NTR}.

I then apply the least squares algorithm and solve for the parametric equation of the ellipse \autocites{gander1994least}{bertoni2010multi}. This algorithm has the advantage that i can still solve for the ellipse using relatively few points,
and these points need not cover the ellipse evenly, as the least squares algorithm will find the best fit ellipse for the points given. 
The rest of the circular algorithms can be used as before. Hence the ellipse NTR is slightly more complex, given the fitting scheme and points required,
but the rest of the solution algorithm is the same. I do a slight modification to the high correlation $\mu$ vector, in order to move the merton point and make space for the resulting NTR.
The new mean asset return is now $\mu = 0.075$ for each asset. This moves the merton point to $(0.2143 , 0.2143)$ from the previous $(0.1905, 0.1905)$.
The solution for each time point is plotted below:
\begin{figure}[!ht]
    \centering
    \includegraphics[scale = 0.38]{Fixed_Cost_NTR_Over_Time_Fixed_Cai_High_Correlation_2d_fc_0.0005_t_4.png}
    \caption{NTR for $2$ assets with fixed costs and high correlation parameters.}
    \label{fig: NTR_Fixed_3d_high_correlation_over_time}
\end{figure}
As expected, the NTR adjusts in the same manner as for the i.i.d case, and shrinks from period $T-1$ to $T-2$. Following this the NTR is constant, with some compounding approximation error across periods.
Therefore, in order to approximate the NTR over the entire investment horizon, only two periods need to be solved for, as the NTR does not change significantly over time.

I now increase the dimensionality of the model to $d = 3$ and look at the No-Trade region for the Schober parameters and for the high correlation parameters.
The resulting \ac{NTR}s are plotted below.
\begin{figure}[!ht]
    \centering
    \begin{subfigure}[t]{0.48\textwidth}
        \centering
        \includegraphics[scale = 0.38]{Fixed_Cost_NTR_Schober_Parameters_d3_fc_0.0005__no_consumption_t_3.png}
        \caption{NTR for 3 assets with fixed costs and Shober parameters.}
        \label{fig: NTR_Fixed_3d_Shober}
        \floatfoot{NTR is at period $T-3$. Fixed cost is at $0.005\%$ of wealth at any time point, before the trading decision is made.}
    
    \end{subfigure}%
    \hfill
    \begin{subfigure}[t]{0.48\textwidth}
        \centering
        \includegraphics[scale = 0.38]{Fixed_Cost_NTR_Cai_High_Correlation_d3_fc_0.0005__no_consumption_t_3.png}
        \caption{NTR for 3 assets with fixed costs and high correlation parameters.}
        \label{fig: NTR_Fixed_3d_high_correlation}
        \floatfoot{NTR is at period $T-3$. Fixed cost is at $0.005\%$ of wealth at any time point, before the trading decision is made.}
    \end{subfigure}
    % Overall caption
    \caption{No trade regions with fixed costs and correlation.}
    \floatfoot{The No-Trade regions are plotted at time $T-3$ which for $5$ periods is $t=2$.}
\end{figure}
The resulting NTRs are now ellipsoids, and the intution from the $2$d case carries over to the $3$d case.
The shape is now similar to a pill or american football, and the high correlation case has more pronounced skewness as expected.


\subsection{Dynamic Portfolio Choice with fixed and proportional costs}
I now consider the model with both fixed and proportional transaction costs, and no consumption.
I first solve the model, with no prior knowledge of the geometric shape of the \ac{NTR}, in order to verify the shape of the \ac{NTR} and the solution algorithm.
\autocite{Dybvig2020} solve this in the static case, with asset specific costs, and find a hexagonic shape, with an inner and outer NTR.
I expect something similar to happen in the dynamic case, however whether the lines connecting the vertices are straight or not is unknown.
The hexagonic shape found by \autocite{Dybvig2020}, seems to stem from asset specific costs, and not from the combination.
I would therefore expect the following: An inner and outer NTR, each stemming from each type of cost.
I consider the Schober parameters, and solve for the next to last period $T-1$ with $2$ assets.
However, since the merton point is close to the origin, and the borders of the feasible space, i add $0.005$ to the mean asset return of each asset, in order to move the merton point away from the borders.
This moves the merton point from $(0.1508, 0.1831)$ to $(0.1986, 0.2187)$.
I set the fixed costs to $0.0003\%$ of the investors total wealth at any time point,
and the proportional costs at $0.002$, i.e $0.2\%$ of the traded amount of wealth in each asset.
\begin{figure}[!ht]
    \centering
    \includegraphics[scale = 0.38]{Verify_NTR_Fixed_Proportional_fc_0.0003_tau_0.002_Schober_Parameters_t_5.png}
    \caption{NTR for $2$ assets with fixed and proportional costs and Schober parameters.}
    \label{fig: Final_NTR_Fixed_Proportional}
    \floatfoot{The optimization scheme ran with $7140$ evenly spaced grid points.}
\end{figure}

The figure displays the crude solution method, i.e the entirely grid based method, of the proportional and fixed cost NTR.
The resulting trade decisions and no trade space are a mixture of the proportional and fixed costs, however the NTR is not a hexagon.
Instead the \ac{NTR} now consists of two distinct shapes. The red points, concern the ellipsoid, resulting from the fixed costs.
For these points, the decision to trade is swayed by the fixed cost, and the investor does not trade at all.
When trading is optimal, the investor trades to the boundary of the proportional cost NTR, which has a parralelogram shape, and is inside the ellipsoid NTR.
Optimal trading occurs to the vertices of this, and the Merton Point is at the right most border of the NTR, as previously seen in solutions to period $T-1$ for proportional costs.
I therefore postulate, that for specific fractions of fixed cost and proportional cost, the vertices of the proportional cost NTR,
will be on the border of the fixed cost NTR, and the NTR will be a combination of the two shapes.
The NTR would in this case have vertices, which are the intersection of the two NTRs, but these would be connected by curved lines.
This is a novel result, not seen in the literature, and i consider this a significant contribution.
Whether the proportional NTR or the fixed cost NTR forms the outer most NTR is unknown a priori, without further investigation.
Interestingly, the proportinal cost part of the \ac{NTR}, is inside the fixed cost NTR, despite the proportional cost being higher than the fixed cost.
It is therefore not trivial to determine parametizations where the two NTRs would form a cohesive shape, and this is left for future research.
As the optimal trades are no longer trivial in any manner, when the location of the \ac{NTR}, its skewness and angles are all unknown
a new tailored solution algorithm would be needed to effectively cover this case. The case of the proportional cost NTR being the outermost NTR is identical to the case of only proportional costs,
and is therefore easily solvable with the previously mentioned solution algorithm.
However when the reverse case is true, as in figure \ref{fig: Final_NTR_Fixed_Proportional} the solution algorithm is not applicable, and a new solution algorithm is needed.
Solutions return the verticies of the inner NTR, and the bisection algorithm is therefore not immediatly applicable either.
First the center point would have to be found, as the center of the inner NTR, and the border points would have to be found, in order to approximate the NTR.
The case of the NTRs forming a cohesive shape would theoretically use the same solution algorithm, however an even worse outcome would be if the proportional cost NTR was sometimes the outermost NTR, and sometimes the innermost NTR.
This is displayed in the schematac figure below:
\begin{figure}[!ht]
    \centering
    \includegraphics[width=0.5\textwidth]{../Sections/Tikz Final Figure.pdf}
    \caption{Schematic of the complex shaped NTR with both fixed and proportional costs.}
    \label{fig: Tikz_Final_TR}
    \floatfoot{Blue parallelogram stems from proportional costs, red ellipse stems from fixed costs. The purple dot is the placement of the merton point, relative to the two NTRs at $t = T-1$, known to be at the upper rightmost corner. The green dot is the placement of the merton point, relative to the two NTRs at $t < T-1$.}    
\end{figure}

I consider this beyond the scope of this thesis, and do not consider this further, leaving this to future research in the field of dynamic portfolio choice with transaction costs. 



\ifdefined\COMPILINGMAIN
% Main file is compiling this section, skip the end
\else
% \printbibliography
\end{document}
\fi